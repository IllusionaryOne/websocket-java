{"name":"websocket-java","tagline":"Websocket client / server Java implementation","body":"# Websocket Java Server implementation #\r\n\r\nhttp://akinaru.github.io/websocket-java/\r\n\r\nWebsocket Server implementation\r\n\r\n<i>Last update 16/05/2015</i>\r\n\r\n* [16/05/2015] add SSL/TLS support\r\n* [09/05/2015] add Client event listener\r\n\r\nYou will find : \r\n* source in ./libwebsocket folder\r\n* secured and unsecured JS websocket client exemples featuring interactions with websocket server in ./exemples/js folder\r\n\r\n<hr/>\r\n\r\n<b>How to launch Websocket Server ?</b>\r\n\r\n```\r\nWebsocketServer server = new WebsocketServer(WEBSOCKET_PORT);\r\nserver.start();\r\n```\r\n\r\nyou specify the port in WEBSOCKET_PORT\r\n\r\n<hr/>\r\n\r\n<b>How to monitor my clients connected to server ?</b>\r\n\r\nJust add a Listener to server object. You have 3 callbacks that will notify you on client connection change and arrival of client messages\r\n\r\n```\r\nserver.addServerEventListener(new IClientEventListener() {\r\n\r\n\t\t\t@Override\r\n\t\t\tpublic void onMessageReceivedFromClient(IWebsocketClient client,\r\n\t\t\t\t\tString message) {\r\n\t\t\t\t//all your message received from websocket client will be here\r\n\t\t\t\tSystem.out.println(\"message received : \" + message);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t@Override\r\n\t\t\tpublic void onClientConnection(IWebsocketClient client) {\r\n\t\t\t\t// when a websocket client connect. This will be called (you can store client object)\r\n\t\t\t\tSystem.out.println(\"Websocket client has connected\");\r\n\t\t\t\t\r\n\t\t\t\tclient.sendMessage(\"Hello,I'm a websocket server\");\r\n\t\t\t\t\r\n\t\t\t\t//client.close(); // this would close the client connection\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t@Override\r\n\t\t\tpublic void onClientClose(IWebsocketClient client) {\r\n\t\t\t\t// when a websocket client connection close. This will be called (you can dismiss client object)\r\n\t\t\t\tSystem.out.println(\"Websocket client has disconnected\");\r\n\t\t\t}\r\n\t\t});\r\n```\r\n\r\n<hr/>\r\n\r\n<b>How to launch a SSL secured websocket server ?</b>\r\n\r\n```\r\nWWebsocketServer server = new WebsocketServer(WEBSOCKET_PORT);\r\n\r\nserver.setSsl(true); // set SSL to true (default is false)\r\n\r\n```\r\n\r\nThen you set your kestore, trustore, type of these certificates, filepath and passwords : \r\n\r\n```\r\nserver.setSSLParams(String KEYSTORE_DEFAULT_TYPE,\r\n\t\t    String KEYSTORE_FILE_PATH,\r\n\t\t    String TRUSTORE_FILE_PATH,\r\n\t\t    String SSL_PROTOCOL,\r\n\t\t    String KEYSTORE_PASSWORD,\r\n\t\t    String TRUSTORE_PASSWORD);\r\n```\r\n\r\nHere is the description of all of these parameters : \r\n\r\n* KEYSTORE_DEFAULT_TYPE : type of certificates used as keystore, it usually contains public and private certificates, common format are PKCS12 and JKS\r\n* TRUSTORE_DEFAULT_TYPE : type of certificates used as trustore, it should contain list of CA cert your server will trust\r\n* KEYSTORE_FILE_PATH : file path to keystore cert file\r\n* TRUSTORE_FILE_PATH: file path to trustore cert file\r\n* SSL_PROTOCOL : ssl protocol used \r\n* KEYSTORE_PASSWORD : keystore file password\r\n* TRUSTORE_PASSWORD : trustore file password\r\n\r\nEventually add event listener as described above and start websocket server : \r\n\r\n```\r\nserver.start();\r\n```\r\n\r\n<hr/>\r\n\r\n<b>Keystore : public and private server certificates</b>\r\n\r\n* To convert cert and key certs to p12 : \r\n\r\n``openssl pkcs12 -export -out server.p12 -inkey server.key -in server.crt``\r\n\r\nThus, you will have : ``String KEYSTORE_DEFAULT_TYPE = \"PKCS12\"``\r\n\r\n* To convert your p12 (containing public and private cert) to jks : \r\n\r\nYou have to know your alias (name matching your cert entry), if you dont have it retrieve it with : ``keytool -v -list -storetype pkcs12 -keystore server.p12``\r\n\r\n``keytool -importkeystore -srckeystore server.p12 -srcstoretype PKCS12 -deststoretype JKS -destkeystore server.jks``\r\n\r\nThus, you will have : ``String KEYSTORE_DEFAULT_TYPE = \"JKS\"``\r\n\r\n<b>Trustore : should contain only CA certificates</b>\r\n\r\nconvert ca cert to jks : \r\n\r\n```keytool -import -alias ca -file ca.crt -keystore cacerts.jks -storepass 123456```\r\n\r\nThus, you will have : ``String TRUSTORE_DEFAULT_TYPE = \"JKS\"``\r\n\r\n<hr/>\r\n\r\n<b>TroubleShooting</b>\r\n\r\n<i>Bad certificate | Unknown CA errors</i>\r\n\r\nThis could mean you didn't import your not-trusted-CA certificate into your browser.\r\n\r\n<i>The remote host closed the connection</i>\r\n\r\nUsually happen when your browser closed the connection before the end of SSL handshake. If you already added your CA to your browser dont worry.\r\nBoth Chrome and Firefox need to MANUALLY add the certificate (in a popup) so putting it in parameter menu don't change anything.\r\n\r\nJust load your URL with \"https\" : https://127.0.0.1:8443 . Browser will prompt you to accept the certificates and it will probably solve your connection error.\r\n\r\n<i>CKR_DOMAIN_PARAMS_INVALID error using openjdk</i>\r\n\r\nWith openjdk-6-jdk and openjdk-7-jdk, I encountered java.security bug described in https://bugs.launchpad.net/ubuntu/+source/openjdk-7/+bug/1006776 triggering a ``CKR_DOMAIN_PARAMS_INVALID`` exception error. Solution was to edit java.security parameters in /etc/java-7-openjdk/security/java.security \r\n\r\nI replaced that : \r\n```\r\nsecurity.provider.9=sun.security.smartcardio.SunPCSC\r\nsecurity.provider.10=sun.security.pkcs11.SunPKCS11 ${java.home}/lib/security/nss.cfg\r\n```\r\n\r\nwith that : \r\n```\r\n#security.provider.9=sun.security.smartcardio.SunPCSC\r\nsecurity.provider.9=sun.security.ec.SunEC\r\n#security.provider.10=sun.security.pkcs11.SunPKCS11 ${java.home}/lib/security/nss.cfg\r\n```\r\n\r\n<b>Browser tested</b>\r\n\r\nThis has been tested on following browser : \r\n* Chrome\r\n* Chromium\r\n* Firefox\r\n\r\n<hr/>\r\n\r\n<b>Debugging SSL connection error</b>\r\n\r\nI recommmend using openssl command line tool to debug ssl connection : \r\n\r\n``openssl s_client -connect 127.0.0.1:8443``\r\n\r\nYou can also use vm argument debugging java ssl implementation : ``-Djavax.net.debug=ssl``\r\n\r\n<hr/>\r\n\r\n<b>Server-Client key/cert generation</b>\r\n\r\nCerts are in libwesocket-test/certs folder, you will find server,client and ca cert build with easy-rsa :\r\n\r\nhttps://github.com/OpenVPN/easy-rsa\r\n\r\nWith last release of easy-rsa, you can build your own key with the following : \r\n\r\n* ``./build-ca`` : generate a new CA for you\r\n* ``./build-server-full myServer`` : will build for you public cert and private cert signed with CA for server\r\n* ``./build-client-full myClient`` : will build for you public cert and private cert signed with CA for client\r\n\r\n<b>How to close my websocket server ?</b>\r\n\r\n``server.closeServer();``\r\n\r\n<hr/>\r\n\r\n<b>COMMAND LINE SYNTAX</b> \r\n\r\nThe following will open a websocket on port 4242 (default port value for my exemple)\r\n\r\n``java -cp ../libs/commons-codec-1.9.jar:../libs/http-endec-1.0.jar:wlandecoder-1.0.jar fr.bmartel.websocket.LaunchServer``\r\n\r\nYou can change port number by specifying yours\r\n\r\n``java -cp ../libs/commons-codec-1.9.jar:../libs/http-endec-1.0.jar:wlandecoder-1.0.jar fr.bmartel.websocket.LaunchServer 4343``\r\n\r\nThis exemple is launched from /release folder\r\n\r\n<hr/>\r\n\r\n<b>Exemple with Javascript Client</b>\r\n\r\n* Launch the websocket server on port 4242\r\n* Open the javascript client page in ./exemples/js/ folder\r\n\r\n=> You have now a complete websocket chat between java server <-> javascript client in websocket \r\n\r\n![client side](https://raw.github.com/akinaru/websocket-java/master/exemples/readme_images/clientSide.png)\r\n\r\n\r\n![server side](https://raw.github.com/akinaru/websocket-java/master/exemples/readme_images/serverSide.png)\r\n<hr/>\r\n\r\n* Project is JRE 1.7 compliant\r\n* You can build it with ant => build.xml\r\n* Development on Eclipse \r\n* Specification from https://tools.ietf.org/html/rfc6455\r\n\r\nSoon : an exemple using this lib as websocket client communicating with a cpp server<br/>\r\nSoon : websocket client exemple\r\n","google":"UA-62569105-1","note":"Don't delete this file! It's used internally to help with page regeneration."}